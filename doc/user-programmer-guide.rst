=========================
User and Programmer Guide
=========================

------------
Introduction
------------

This page contains the User and Programmer guide of the reference implementation of the Revenue Settlement and Sharing Sytem GE.

----------
User Guide
----------

The RSS is a software which provides pure backend functionality to other applications (e.g. Generic Enablers or end user facing applications). However, a web interface is offered in order to allow RSS and store administrators interact with the back-end functionality. This section covers the functionality of the administration interface.

The administration interface only can be accesed by those users that have been regsitered as administrators of the RSS in the FIWARE Identity Manager (Using roles). Aditionally, administrators of the stores already registered can also access this interface. In this case, they will be only allowed to view and use it limited to the scope of the assets that belongs to their store.

Register Store
==============

The administration interface allows to register new stores, which are charging information sources. To do that, it is required to include the email of the user of the FIWARE identity manager who admins the concrete store instance, and a display name for the store.

Once an Store is registered, it is possible to send charging information to the RSS in order to perform the revenue sharing of its providers.

.. image:: images/installation/rss_sanity_2.png
   :align: center

.. note::
    Store administrators cannot perform this action

Register Provider
=================

Additionally, it is possible to use the administration interface to register providers of a given store. To do that, it is necessary to provide an id, a display name, and select a store. 

.. image:: images/installation/rss_sanity_3.png
   :align: center

.. note::
  Store administrators only can register providers of the store they are owning

View Providers
==============

It is possible to view the providers already registered in the RSS using the administration interface. To view existing providers click on *View Providers in database*.


.. image:: images/installation/rss_sanity_4.png
   :align: center

.. image:: images/user/view_prov.png
   :align: center

.. note::
  Store administrators only can view providers of the store they are owning

Create Revenue Sharing Model
============================

Revenue Sharing Models in the RSS specify how the revenues generated by a set of offerings must be distributed. In this regard, the administration interface allows to create revenue sharing models by clicking on *Create RS Model*.


.. image:: images/installation/rss_sanity_6.png
   :align: center

The first step for creating a RS model is selecting the Store where the charging information is being generated, and specify the percentage of the revenue that belongs to their owners (*Store Value*). Then, it is necessary to specify the provider, who owns the offering or group of offerings whose revenues are going to be distrubuted using the current model, and provide the percentage of the revenue that belongs to her (*Provider Value*).

Next, it is required to fill the *Product Class*. This value is used as the identifier of the RS model and identifies an offering or group of offerings.


.. image:: images/user/create_model_1.png
   :align: center

There are some offerings, that are composed of services belonging to different providers. To deal with that, it is possible to specify additional stakeholders to the revenue sharing model including their percentage of the revenues.


.. image:: images/user/create_model_2.png
   :align: center

Finally, the model is created by clicking on *Create Model*

.. image:: images/user/create_model_3.png
   :align: center

.. note::
  Store administrators only can create RS models for the providers of the store they are owning


View Revenue Sharing Models
===========================

The administration interface allows to view existing RS models by clicking on *View RS models in database*.


.. image:: images/installation/rss_sanity_8.png
   :align: center

.. image:: images/user/view_models.png
   :align: center

.. note::
  Store administrators only can view RS models of the store they are owning

View Transactions
=================

As stated, the RSS provides pure backend functionality. In this respect, the different transactions with charging information generated in the stores are fed to the RSS via API. Nevertheless, the administration interface allows to view the existing (not aggregated) transactions. To do that, click on *View transactions in database*.

.. image:: images/user/view_trans_1.png
   :align: center

.. image:: images/user/view_trans_2.png
   :align: center

Launch Settlement
=================

Transactions stored in the RSS contain charging information that is used to calculate the revenue sharing using the corresponding RS model. In this regard, the administration interface allows to launch the process that aggregates charging info and calculates the revenue sharing (The Settlement process).

The interface allows to launch the settlement for all the pending transactions, for the all the pending transactions generated in a store, or for all the pending transactions belonging to a concrete provider.

This can be done in the settlement section by selecting the store, the provider, and clicking *Launch*


.. image:: images/user/launch_sett.png
   :align: center

.. note::
  Store administrators only can launch the process for their store or its providers.

View Revenue Sharing Reports
============================

The settlement process generates a set of reports that specify how revenues must be distributed. This reports can be viewed in the admin interface by clicking on *View reports*.


.. image:: images/user/view_rep_1.png
   :align: center

.. image:: images/user/view_rep_2.png
   :align: center

----------------
Programmer Guide
----------------


